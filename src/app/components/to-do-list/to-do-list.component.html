<app-toast></app-toast>
<div class="wrap">
  <app-spinner [isLoading]="isLoading"></app-spinner>
  <mat-card class="to-do-list-card" [class.hide]="isLoading">
    <mat-card-title class="title">ToDo List</mat-card-title>
    <!-- koshelnikov: add named method hasItems()-->
    <ng-container *ngIf="items.length !== 0">
      <mat-button-toggle-group name="taskFilter" aria-label="Task Filter" class="filter">
        <!-- add named method setFilter(enum) -->
        <mat-button-toggle value="All" (click)="selectedFilter = null">All</mat-button-toggle>
        <mat-button-toggle value="Completed" (click)="selectedFilter = Status.COMPLETED">Completed</mat-button-toggle>
        <mat-button-toggle value="Active" (click)="selectedFilter = Status.IN_PROGRESS">Active</mat-button-toggle>
      </mat-button-toggle-group>
    </ng-container>

    <mat-list>
      <mat-list-item class="item"
                     *ngFor="let item of items | filterItems:selectedFilter"
                     (dblclick)="editItem(item)"
                     [class.selected]="item.id === selectedId">
        <ng-container *ngIf="!editingItem || editingItem !== item">
          <app-to-do-list-item
            [item]="item"
            (deleteItemEvent)="deleteItem($event)"
            (changeStatusEvent)="changeStatus($event)"
          ></app-to-do-list-item>
        </ng-container>
        <!-- koshelnikov:
             1. Рекомендую включить код редактирования внутрь комопонета item под компонентом,
                т.к. компонент списка достаточно избыточен.
             2. Сам код редактирования также вынести в компонент.
             3. Плюсы от инкапсуляции заключаются в том, что все мета данные, которые относятся к View
                части будут находится внутри компонента.
         -->
        <ng-container *ngIf="editingItem === item">
          <mat-form-field class="form-field">
            <input class="input" matInput type="text" [(ngModel)]="item.text">
            <app-button [styles]="['button', 'button-update']"
                        (click)="updateItem(item)"
                        [tooltipMessage]="'Update task'"
            >Save</app-button>
          </mat-form-field>
        </ng-container>
      </mat-list-item>
    </mat-list>

    <!-- koshelnikov: add named method getNextId() -->
    <app-todo-create-item [index]="getLastId() + 1"
                          (save)="addItem($event)"
    >
    </app-todo-create-item>
  </mat-card>
  <router-outlet></router-outlet>
</div>
